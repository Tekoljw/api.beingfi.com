<include file="Public:header"/>
<style>
	.table-striped tbody tr:hover {
		background-color: #CDDEFB;
	}
	.data-table tbody td {
		height: 40px;
		line-height: 40px;
	}
	.btn-primary {
		background-color: #1abc9c;
	}
</style>
<div id="main-content">
	<div id="top-alert" class="fixed alert alert-error" style="display: none;">
		<button class="close fixed" style="margin-top: 4px;">&times;</button>
		<div class="alert-content">警告内容</div>
	</div>
	<div id="main" class="main">
		<div class="main-title-h">
			<span class="h1-title">监控到账数据</span>
		</div>
		<div class="cf">
			<div class="search-form fr cf">
				<div class="sleft">
					<form name="formSearch" id="formSearch" method="get" name="form1">
						<!-- 时间筛选 -->
                        <script type="text/javascript" src="/Public/layer/laydate/laydate.js"></script>
                        <select style="width: 110px; float: left; margin-right: 10px;" name="status" class="form-control">
							<option value="" <empty name="Think.get.status">selected</empty> >处理状态</option>
							<option value="99" <eq name="Think.get.status" value="99">selected</eq> >全部状态</option>
							<option value="0" <eq name="Think.get.status" value="0">selected</eq> >待处理</option>
							<option value="1" <eq name="Think.get.status" value="1">selected</eq> >已处理</option>
						</select>
						<select style=" width: 130px; float: left; margin-right: 10px;" name="field" class="form-control">
							<option value="bankcard" <eq name="Think.get.field" value="bankcard">selected</eq> >银行卡号</option>
							<option value="return_order_id" <eq name="Think.get.field" value="return_order_id">selected</eq> >订单后五位</option>
						</select>
						<input type="text" name="name" class="search-input form-control" value="{$Think.get.name}" placeholder="请输入查询内容" style="width: 180px;">
						<a class="sch-btn" href="javascript:;" id="search"> <i class="btn-search"></i> </a>
					</form>
					<script>
						//搜索功能
						$(function () {
							$('#search').click(function () {
								$('#formSearch').submit();
							});
						});
						//回车搜索
						$(".search-input").keyup(function (e) {
							if (e.keyCode === 13) {
								$("#search").click();
								return false;
							}
						});
					</script>
				</div>
			</div>
		</div>
		<div class="data-table table-striped">
			<form id="form" action="{:U('Exchange/mytxExcel')}" method="post" class="form-horizontal">
				<table class="">
					<thead>
					<tr>
						<th class="row-selected row-selected"><input class="check-all" type="checkbox"/></th>
						<th width="">编号</th>
						<th width="">银行卡号</th>
						<th width="">订单后五位</th>
						<th width="">金额</th>
						<th width="">日期</th>
						<th width="">状态</th>
						<th width="">录入时间</th>
						<th width="">处理时间</th>
						<th width="">操作</th>
					</tr>
					</thead>
					<tbody>
					<notempty name="list">
						<volist name="list" id="vo">
							<tr>
								<td><input class="ids" type="checkbox" name="id[]" value="{$vo.id}"/></td>
								<td>{$vo.id}</td>
								<td><b style="color: #106EFF">{$vo.bankcard}</b></td>
								<td><b style="color: #A98A3F">{$vo.return_order_id}</b></td>
								<td>{$vo.real_amount}</td>
								<td>{$vo.date}</td>
								<td>
									<eq name="vo.status" value="0">未处理</eq>
									<eq name="vo.status" value="1">已确认</eq>
								</td>
								<td>{$vo.addtime|addtime}</td>
								<td>{$vo.dealtime|addtime}</td>
								<td>
									<a href="javascript:void(0)" onclick="resetCancelOrderQueen('{$vo['id']}')" class="ajax-get btn btn-xs btn-primary">设为已确认</a>
								</td>
							</tr>
						</volist>
						<else/>
						<td colspan="12" class="text-center empty-info"><i class="glyphicon glyphicon-exclamation-sign"></i>暂无数据</td>
					</notempty>
					</tbody>
				</table>
			</form>
            <div class="page">
                <div>{$page}</div>
            </div>
		</div>
	</div>
</div>
<script type="text/javascript">
//提交表单
$('#submit').click(function () {
	$('#form').submit();
});

//重置删除订单为完成
function resetCancelOrderQueen(id) {
    layer.config({
        extend: 'extend/layer.ext.js'
    });
    layer.ready(function() {
        //默认prompt
        //需要执行的方法
        $.post("{:U('Exchange/paymentRecordEdit')}", {
            id: id
        }, function(data) {
            if (data.status == 1) {
                layer.msg(data.info, { icon: 1 }, function (){ 
                    window.location.reload();
                });
            } else {
                layer.msg(data.info, { icon: 2 });
                if (data.url) {
                    window.location = data.url;
                }
            }
        }, "json");
    });
}

$(".page > div").children("a").each(function(){
	var ahref = $(this).attr('href');
	var ahrefarr = ahref.split("/");
	var ahlength = ahrefarr.length;
	var newhref = '';
	for(var i=0;i<ahlength;i++){
		if(i<3 && i>0){
			newhref += "/"+ahrefarr[i];
		}
		if(i==3){
			newhref += "/"+ahrefarr[i]+".html?";
		}
		if(i>=4 && i%2==0){
			newhref += "&"+ahrefarr[i]+"="+ahrefarr[i+1];
		}
	}
	$(this).attr("href",newhref);
});
</script>
<include file="Public:footer"/>
<block name="script">
<script type="text/javascript" charset="utf-8">
	//导航高亮
	highlight_subnav("{:U('Exchange/paymentRecord')}");
	$('title').html('监控信息列表-'+'__WEBTITLE__');
</script>
</block>