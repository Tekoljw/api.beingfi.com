<include file="Public:header"/>
<div id="main-content">
  <div id="top-alert" class="fixed alert alert-error" style="display: none;">
    <button class="close fixed" style="margin-top: 4px;">&times;</button>
    <div class="alert-content">警告内容</div>
  </div>
  <div id="main" class="main">
    <div class="main-title-h">
      <span class="h1-title">清理日志数据</span>
    </div>
    <div class="tab-wrap">
      <div class="tab-content">
        <form id="form" action="{:U('Tools/clearData')}" method="post" class="form-horizontal">
  			<form class="layui-form" action="" id="form" autocomplete="off" >
  				<input type="hidden" name="orderid" value="<{$order.id}>">
  			  <div class="layui-form-item">
  				<label class="layui-form-label">数据类型：</label>
  					<div class="layui-input-block">
							<label class="checkbox">
								<input type="checkbox" name="type[1]" lay-skin="primary" title="交易记录" value="1" class="level_two">交易记录
							</label>
							<label class="checkbox">
								<input type="checkbox" name="type[2]" lay-skin="primary" title="用户记录" value="2" class="level_two">用户记录
							</label>
							<label class="checkbox">
								<input type="checkbox" name="type[3]" lay-skin="primary" title="理财结算记录" value="3" class="level_two">理财结算记录
							</label>
							<label class="checkbox">
								<input type="checkbox" name="type[4]" lay-skin="primary" title="认购记录" value="4" class="level_two">认购记录
							</label>
							<label class="checkbox">
								<input type="checkbox" name="type[5]" lay-skin="primary" title="资金记录" value="5" class="level_two">资金记录
							</label>
              <label class="checkbox">
                <input type="checkbox" name="type[6]" lay-skin="primary" title="操作记录" value="6" class="level_two">操作记录
              </label>
              <label class="checkbox">
                <input type="checkbox" name="type[7]" lay-skin="primary" title="分红记录" value="7" class="level_two">分红记录
              </label>
  					</div>
  			  </div>
          <!-- 时间筛选 -->
          <script type="text/javascript" src="/Public/layer/laydate/laydate.js"></script>
          <input type="text" class="form-control" style=" width: 170px; float: left; margin-right: 10px;" name="starttime" value="{:I('get.starttime')}" placeholder="开始日期" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})">
          <input type="text" class="form-control" style=" width: 170px; float: left; margin-right: 10px;" name="endtime" value="{:I('get.endtime')}" placeholder="结束日期" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})">
  				<tr class="controls">
            <td class="item-label">谷歌安全码 :</td>
  					<div class="layui-input-inline">
  						<input type="text" name="google_code" autocomplete="off"
  							   placeholder="请输入谷歌安全码" class="layui-input" value="">
  					</div>
  				</div>
    			<tr class="controls">
            <td class="item-label"></td>
            <td>
              <div class="form-item cf">
                <button class="btn submit-btn ajax-post" id="submit" type="submit" target-form="form-horizontal">提交</button>
                <a class="btn btn-return" href="{$Think.server.HTTP_REFERER}">返 回</a>
                <notempty name="data.id"><input type="hidden" name="id" value="{$data.id}"/>
                </notempty>
              </div>
            </td>
          </tr>
  			</form>
      </div>
    </div>
  </div>
</div>
<include file="Public/footer"/>
<script src="/Public/Front/js/Util.js" charset="utf-8"></script>
<script>
var issubmit=false;
layui.use(['layer', 'form','laydate'], function(){
  var form = layui.form
  ,laydate = layui.laydate
  ,layer = layui.layer;

    //常规用法
    laydate.render({
        elem: '#createtime',
		type: 'datetime',
        theme: 'molv',
        range: '|'
    });
    //选中
    $('.layui-form-checkbox').on('click', function (e){
        var children = $(this).parent('.layui-input-block').find('.layui-form-checkbox');
        var input = $(this).parent('.layui-input-block').find('input');

        if($(this).prev('input').hasClass('level_three')){
            if($(this).hasClass('layui-form-checked') == true){
                $(this).addClass('layui-form-checked')
                $(this).prev('input').prop('checked',true);
            }else{
                $(this).removeClass('layui-form-checked');
                $(this).prev('input').prop('checked',false);
            }
        }else{
            if($(this).hasClass('layui-form-checked') == true){
                children.addClass('layui-form-checked')
                input.prop('checked',true);
            }else{
                children.removeClass('layui-form-checked');
                input.prop('checked',false);
            }
        }
    })
  //监听提交
  form.on('submit(save)', function(data){
      layer.confirm('确认要删除所选时间段内的数据？该操作不可恢复，建议做好数据库备份，请谨慎操作！',{
          btn: ['确定','取消'] //按钮
      }, function(){
          var loading = '';
              $.ajax({
              url:"<{:U('Tools/clearData')}>",
              type:"post",
              data:$('#form').serialize(),
      			  beforeSend:function(){
                        loading=layer.load();
      			  },
              success:function(res){
                  layer.close(loading);
                  if(res.status){
                      layer.alert(res.msg? res.msg :"清理成功！", {icon: 6},function () {
                          parent.location.reload();
                          var index = parent.layer.getFrameIndex(window.name);
                          parent.layer.close(index);
                      });
                  }else{
                      layer.alert(res.msg, {icon: 5},function (index) {
                          layer.close(index)
                      });
                  }
              },
			  complete: function(){
                  layer.close(loading);
			  },
			  error:function(){
                  layer.close(loading);
                  layer.alert('连接错误');
			  }

          });
      }, function(){
      });
   	 return false;
  });
    form.on('radio(auth_type)',function(data){
        if(data.value == 1) {
            $('#auth_google').show();
        } else {
            $('#auth_google').hide();
        }
    });
});
</script>
</body>
</html>
